<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shivgauri Agro - Your Partner in Farming Success</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind for custom colors and font -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'agro-green': '#16A34A', // A deep, strong green
                        'agro-yellow': '#FBBF24', // A harvest yellow/amber
                        'agro-dark': '#1F2937', // Dark gray for text
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Ensuring Inter is used */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
    </style>
</head>
<body class="bg-gray-50 font-sans antialiased text-agro-dark">

    <!-- Header & Navigation -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
            <h1 class="text-2xl font-extrabold text-agro-green tracking-wider">
                рд╢рд┐рд╡рдЧреМрд░реА <span class="text-agro-dark">Agro</span>
            </h1>
            <!-- Primary CTA for Mobile/Desktop -->
            <a href="#contact" class="px-4 py-2 bg-agro-green text-white font-semibold text-sm rounded-lg shadow-lg hover:bg-green-700 transition duration-300 transform hover:scale-105">
                рдореБрдлреНрдд рд╕рд▓рд╛рд╣ рдХреЙрд▓
            </a>
        </div>
    </header>

    <main>
        <!-- 1. Hero Section -->
        <section class="bg-gray-100 pt-16 pb-20 md:py-32">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <p class="text-lg md:text-xl text-agro-green font-semibold mb-3">рднрд╛рд░рдд рдХреЗ рдХрд┐рд╕рд╛рдиреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рдорд░реНрдкрд┐рдд</p>
                <h2 class="text-4xl sm:text-5xl lg:text-7xl font-extrabold mb-6 leading-tight">
                    рдЖрдкрдХреЗ рдЦреЗрдд рдХреА рдкреНрд░рдЧрддрд┐,<br class="hidden sm:inline"> рд╣рдорд╛рд░реА <span class="text-agro-green">рдЬрд┐рдореНрдореЗрджрд╛рд░реАред</span>
                </h2>
                <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto mb-10">
                    рд╣рдо рдСрди-рдХреЙрд▓ рдореБрдлреНрдд рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдорд╛рд░реНрдЧрджрд░реНрд╢рди рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рд╡рд┐рд╕реНрддреГрдд рд╕рдорд╛рдзрд╛рди рдХреЗ рд▓рд┐рдП рд╕рд╢реБрд▓реНрдХ рдСрди-рд╕рд╛рдЗрдЯ рдлрд╛рд░реНрдо рд╡рд┐рдЬрд┐рдЯ рдХреА рд╕реБрд╡рд┐рдзрд╛ рднреА рдЙрдкрд▓рдмреНрдз рд╣реИред
                </p>
                <!-- UPDATED PHONE NUMBER HERE -->
                <a href="tel:8625830898" class="inline-flex items-center justify-center px-8 py-4 border border-transparent text-lg font-bold rounded-xl shadow-xl text-white bg-agro-yellow hover:bg-yellow-600 transition duration-300 transform hover:scale-105 ring-4 ring-agro-yellow/50">
                    <svg class="w-6 h-6 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                    рдлреНрд░реА рдХреЙрд▓ рдХрд░реЗрдВ: 8625830898
                </a>
            </div>
        </section>

        <!-- 2. Services Section -->
        <section id="services" class="py-16 md:py-24 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h3 class="text-3xl sm:text-4xl font-extrabold text-center mb-12">рд╣рдорд╛рд░реА рд╕реЗрд╡рд╛рдПрдБ: рдЖрдкрдХреА рдЬрд╝рд░реВрд░рдд рдХреЗ рдЕрдиреБрд╕рд╛рд░</h3>

                <div class="grid md:grid-cols-2 gap-8 lg:gap-12">

                    <!-- Service Card 1: Free On-Call Consultation -->
                    <div class="bg-green-50 border-t-4 border-agro-green p-6 sm:p-8 rounded-xl shadow-lg hover:shadow-xl transition duration-300">
                        <div class="flex items-center mb-4">
                            <div class="bg-agro-green/10 p-3 rounded-full mr-4">
                                <svg class="w-8 h-8 text-agro-green" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path></svg>
                            </div>
                            <h4 class="text-2xl font-bold text-agro-dark">рдореБрдлреНрдд рдлреЛрди/рд╡реАрдбрд┐рдпреЛ рд╕рд▓рд╛рд╣</h4>
                        </div>
                        <p class="text-gray-600 mb-6">
                            рдЫреЛрдЯреА рд╕рдорд╕реНрдпрд╛рдУрдВ, рддреНрд╡рд░рд┐рдд рдорд╛рд░реНрдЧрджрд░реНрд╢рди, рдпрд╛ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╕рд▓рд╛рд╣ рдХреЗ рд▓рд┐рдПред рд╣рдо рд╕рдордЭрддреЗ рд╣реИрдВ рдХрд┐ рд╣рд░ рдХрд┐рд╕рд╛рди рдХреЛ рддреБрд░рдВрдд рдорджрдж рдХреА рдЬрд╝рд░реВрд░рдд рд╣реЛ рд╕рдХрддреА рд╣реИред
                        </p>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 mb-8 ml-4">
                            <li>рддреНрд╡рд░рд┐рдд рдлрд╕рд▓ рд╕реНрд╡рд╛рд╕реНрдереНрдп рдЬрд╛рдБрдЪ</li>
                            <li>рдХреАрдЯ рдпрд╛ рд░реЛрдЧ рдХреА рдкрд╣рдЪрд╛рди</li>
                            <li>рд╕рд░рдХрд╛рд░реА рдпреЛрдЬрдирд╛рдУрдВ рдкрд░ рд╕рд╛рдорд╛рдиреНрдп рдЬрд╛рдирдХрд╛рд░реА</li>
                        </ul>
                        <!-- UPDATED PHONE NUMBER HERE -->
                        <a href="tel:8625830898" class="block w-full text-center py-3 bg-agro-green text-white font-semibold rounded-lg hover:bg-green-700 transition duration-300">
                            рдЕрднреА рдореБрдлреНрдд рд╕рд▓рд╛рд╣ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рдХрд░реЗрдВ
                        </a>
                    </div>

                    <!-- Service Card 2: Paid On-Site Consultation -->
                    <div class="bg-yellow-50 border-t-4 border-agro-yellow p-6 sm:p-8 rounded-xl shadow-lg hover:shadow-xl transition duration-300">
                        <div class="flex items-center mb-4">
                            <div class="bg-agro-yellow/10 p-3 rounded-full mr-4">
                                <svg class="w-8 h-8 text-agro-dark" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.828 0l-4.243-4.243m12.424-1.414l-4.242 4.242m-4.242-4.242L10.985 13.985a1.998 1.998 0 002.828 0l4.242-4.242m-12.424 0L10.985 6.985a1.998 1.998 0 012.828 0l4.242 4.242M12 21a9 9 0 100-18 9 9 0 000 18z"></path></svg>
                            </div>
                            <h4 class="text-2xl font-bold text-agro-dark">рд╕рд╢реБрд▓реНрдХ рдСрди-рд╕рд╛рдЗрдЯ рд╡рд┐рдЬрд╝рд┐рдЯ</h4>
                        </div>
                        <p class="text-gray-600 mb-6">
                            рдЧрд╣рди рдорд┐рдЯреНрдЯреА рд╡рд┐рд╢реНрд▓реЗрд╖рдг, рдЕрдиреБрдХреВрд▓рд┐рдд рдлрд╕рд▓ рдпреЛрдЬрдирд╛, рдФрд░ рдЖрдкрдХреЗ рдЦреЗрдд рдкрд░ рд╡реНрдпрдХреНрддрд┐рдЧрдд рджреМрд░рд╛ред (рд╢реБрд▓реНрдХ рд▓рд╛рдЧреВ)
                        </p>
                        <ul class="list-disc list-inside space-y-2 text-gray-700 mb-8 ml-4">
                            <li>рдорд┐рдЯреНрдЯреА рдФрд░ рдЬрд▓ рдХрд╛ рд╡рд┐рд╕реНрддреГрдд рдкрд░реАрдХреНрд╖рдг</li>
                            <li>рдлрд╕рд▓ рдЪрдХреНрд░ рдФрд░ рдЙрд░реНрд╡рд░рдХ рдХреА рдХрд╕реНрдЯрдо рдпреЛрдЬрдирд╛</li>
                            <li>рдЦреЗрдд рдХреА рдЙрддреНрдкрд╛рджрдХрддрд╛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░рд┐рдкреЛрд░реНрдЯ</li>
                        </ul>
                        <a href="#contact-form" class="block w-full text-center py-3 bg-agro-dark text-white font-semibold rounded-lg hover:bg-gray-700 transition duration-300">
                            рдСрди-рд╕рд╛рдЗрдЯ рд╡рд┐рдЬрд╝рд┐рдЯ рдХреЗ рд▓рд┐рдП рдкреВрдЫрддрд╛рдЫ рдХрд░реЗрдВ
                        </a>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- 3. Gemini LLM Feature: Instant Crop Advice -->
        <section class="py-16 md:py-24 bg-agro-green/10" id="gemini-advice">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                <h3 class="text-3xl sm:text-4xl font-extrabold text-center mb-4 text-agro-dark">
                    тЬи рддреБрд░рдВрдд рдлрд╕рд▓ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рд╕рд▓рд╛рд╣ (Ask the AI)
                </h3>
                <p class="text-center text-lg text-gray-600 mb-8">
                    рдЕрдкрдиреА рдлрд╕рд▓ рдФрд░ рд╕рдорд╕реНрдпрд╛ рдЯрд╛рдЗрдк рдХрд░реЗрдВ, рдФрд░ рд╣рдорд╛рд░рд╛ AI рддреБрд░рдВрдд рдкреНрд░рд╛рдердорд┐рдХ рдирд┐рджрд╛рди рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рд╕рдорд╛рдзрд╛рди рджреЗрдЧрд╛ред (рд╡рд┐рд╕реНрддреГрдд рдФрд░ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд╕рд▓рд╛рд╣ рдХреЗ рд▓рд┐рдП рдХреГрдкрдпрд╛ рд╣рдореЗрдВ рдХреЙрд▓ рдХрд░реЗрдВ!)
                </p>

                <div class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl">
                    <div class="space-y-4">
                        <div>
                            <label for="crop_query" class="block text-sm font-medium text-gray-700">рдЕрдкрдиреА рдлрд╕рд▓ рдХрд╛ рдирд╛рдо рдФрд░ рд╕рдорд╕реНрдпрд╛ рд▓рд┐рдЦреЗрдВ (рдЬреИрд╕реЗ: рдЧреЗрд╣реВрдБ рдореЗрдВ рдкрддреНрддрд┐рдпрд╛рдБ рдкреАрд▓реА рдкрдбрд╝ рд░рд╣реА рд╣реИрдВ)</label>
                            <textarea id="crop_query" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-agro-green focus:border-agro-green" placeholder="рдХреГрдкрдпрд╛ 1-2 рдкрдВрдХреНрддрд┐рдпреЛрдВ рдореЗрдВ рдЕрдкрдиреА рд╕рдорд╕реНрдпрд╛ рд╕реНрдкрд╖реНрдЯ рдХрд░реЗрдВ..."></textarea>
                        </div>
                        <button onclick="generateAdvice()" id="adviceButton" class="w-full py-3 bg-agro-yellow text-agro-dark font-bold text-lg rounded-lg shadow-md hover:bg-yellow-600 transition duration-300 flex items-center justify-center disabled:opacity-50">
                            <svg class="w-5 h-5 mr-2 animate-spin hidden" id="loadingIcon" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M16.03 5.093l-4.524 9.048-4.524-9.048a1 1 0 011.664-.99l2.86 2.86 2.86-2.86a1 1 0 011.664.99z"></path></svg>
                            тЬи рд╕рд▓рд╛рд╣ рдЬрдирд░реЗрдЯ рдХрд░реЗрдВ
                        </button>
                    </div>

                    <!-- AI Results Area -->
                    <div id="aiResultContainer" class="mt-8 border-t border-gray-200 pt-6 hidden">
                        <h4 class="text-xl font-bold text-agro-green mb-3">AI рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдирд┐рджрд╛рди:</h4>
                        <div id="aiResponse" class="p-4 bg-green-50 rounded-lg text-gray-700 whitespace-pre-wrap leading-relaxed"></div>
                        <div id="aiSources" class="mt-4 text-xs text-gray-500 italic border-t pt-2"></div>
                        <div class="mt-4 p-3 bg-yellow-100 border-l-4 border-agro-yellow rounded-lg">
                            <p class="text-sm font-semibold text-agro-dark">
                                ЁЯТб рдпрд╣ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп AI рдирд┐рджрд╛рди рд╣реИред рдЕрдкрдиреЗ рдЦреЗрдд рдХреЗ рд▓рд┐рдП рд╕рдЯреАрдХ рдФрд░ рд╡реНрдпрдХреНрддрд┐рдЧрдд рд╕рдорд╛рдзрд╛рди рд╣реЗрддреБ, рдХреГрдкрдпрд╛ **рд╢рд┐рд╡рдЧреМрд░реА рдПрдЧреНрд░реЛ** рдХреЗ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮреЛрдВ рдХреЛ <a href="tel:8625830898" class="text-agro-green font-bold">8625830898</a> рдкрд░ рдХреЙрд▓ рдХрд░реЗрдВред
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. About Us / Trust Section (Original 3) -->
        <section class="py-16 md:py-24 bg-gray-100">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h3 class="text-3xl sm:text-4xl font-extrabold text-center mb-12">рд╣рдо рдХреМрди рд╣реИрдВ: рд╢рд┐рд╡рдЧреМрд░реА рдПрдЧреНрд░реЛ</h3>
                <div class="max-w-4xl mx-auto text-center">
                    <p class="text-lg text-gray-700 mb-6">
                        рд╣рдо, рд╢рд┐рд╡ рдФрд░ рдЧреМрд░реА, рдХреГрд╖рд┐ рдореЗрдВ рджрд╢рдХреЛрдВ рдХреЗ рдЕрдиреБрднрд╡ рдХреЗ рд╕рд╛рде рдпрд╣ рдорд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рд╕рд╣реА рд╕рдордп рдкрд░ рд╕рд╣реА рд╕рд▓рд╛рд╣ рдХрд┐рд╕реА рднреА рдХрд┐рд╕рд╛рди рдХреА рдХрд┐рд╕реНрдордд рдмрджрд▓ рд╕рдХрддреА рд╣реИред 'рд╢рд┐рд╡рдЧреМрд░реА' рдирд╛рдо рд╕рдореГрджреНрдзрд┐, рдЙрд░реНрд╡рд░рддрд╛ рдФрд░ рд╕рдорд░реНрдкрдг рдХрд╛ рдкреНрд░рддреАрдХ рд╣реИ, рдФрд░ рд╣рдо рдЗрд╕реА рднрд╛рд╡рдирд╛ рд╕реЗ рд╣рд░ рдЦреЗрдд рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВред
                    </p>
                    <p class="text-lg text-gray-700 font-semibold">
                        рд╣рдорд╛рд░рд╛ рдорд┐рд╢рди рднрд╛рд░рддреАрдп рдХрд┐рд╕рд╛рдиреЛрдВ рдХреЛ рдЖрдзреБрдирд┐рдХ рдФрд░ рдЯрд┐рдХрд╛рдК рдХреГрд╖рд┐ рддрдХрдиреАрдХреЛрдВ рд╕реЗ рд╕рд╢рдХреНрдд рдмрдирд╛рдирд╛ рд╣реИред
                    </p>
                    <div class="mt-8 flex justify-center space-x-4">
                        <!-- Placeholder for founders' images/icons -->
                        <span class="inline-flex items-center justify-center h-16 w-16 rounded-full bg-agro-green/20 text-agro-green text-3xl font-bold">рд╢</span>
                        <span class="inline-flex items-center justify-center h-16 w-16 rounded-full bg-agro-yellow/20 text-agro-yellow text-3xl font-bold">рдЧ</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. Contact Form / CTA Section (Original 4) -->
        <section id="contact" class="py-16 md:py-24 bg-white">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
                <h3 class="text-3xl sm:text-4xl font-extrabold text-center mb-4">рдСрди-рд╕рд╛рдЗрдЯ рд╡рд┐рдЬрд╝рд┐рдЯ рдХреЗ рд▓рд┐рдП рдкреВрдЫрддрд╛рдЫ рдХрд░реЗрдВ</h3>
                <p class="text-center text-lg text-gray-600 mb-12">рдХреГрдкрдпрд╛ рдпрд╣ рдлрд╝реЙрд░реНрдо рднрд░реЗрдВ, рдФрд░ рд╣рдо рдЬрд▓реНрдж рд╣реА рдЖрдкрд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВрдЧреЗред</p>

                <div id="contact-form" class="bg-gray-50 p-6 sm:p-10 rounded-xl shadow-2xl border border-gray-100">
                    <form onsubmit="handleSubmit(event)">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label for="name" class="block text-sm font-medium text-gray-700">рдЖрдкрдХрд╛ рдирд╛рдо</label>
                                <input type="text" id="name" name="name" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-agro-green focus:border-agro-green">
                            </div>
                            <div class="space-y-2">
                                <label for="phone" class="block text-sm font-medium text-gray-700">рдлрд╝реЛрди рдирдВрдмрд░</label>
                                <input type="tel" id="phone" name="phone" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-agro-green focus:border-agro-green">
                            </div>
                        </div>

                        <div class="mt-6 space-y-2">
                            <label for="location" class="block text-sm font-medium text-gray-700">рдЦреЗрдд рдХрд╛ рд╕реНрдерд╛рди (рд░рд╛рдЬреНрдп рдФрд░ рдЬрд┐рд▓рд╛)</label>
                            <input type="text" id="location" name="location" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-agro-green focus:border-agro-green">
                        </div>

                        <div class="mt-6 space-y-2">
                            <label for="message" class="block text-sm font-medium text-gray-700">рдЖрдк рдХрд┐рд╕ рдЪреАрдЬрд╝ рдкрд░ рд╕рд▓рд╛рд╣ рдЪрд╛рд╣рддреЗ рд╣реИрдВ?</label>
                            <textarea id="message" name="message" rows="4" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-agro-green focus:border-agro-green"></textarea>
                        </div>

                        <button type="submit" class="mt-8 w-full py-3 bg-agro-green text-white font-bold text-lg rounded-lg shadow-md hover:bg-green-700 transition duration-300">
                            рдкреВрдЫрддрд╛рдЫ рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВ
                        </button>

                        <!-- Message Box for Submission Status -->
                        <div id="statusMessage" class="mt-4 p-3 bg-blue-100 text-blue-700 rounded-lg hidden"></div>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-agro-dark py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-400">
            <p class="mb-2">┬й 2024 Shivgauri Agro. All rights reserved.</p>
            <p class="text-sm">
                <!-- UPDATED EMAIL AND PHONE NUMBER HERE -->
                рдИрдореЗрд▓: <a href="mailto:gayatrisbairagi@gmail.com" class="text-agro-green hover:text-agro-yellow">gayatrisbairagi@gmail.com</a> | реЮреЛрди: <a href="tel:8625830898" class="text-agro-green hover:text-agro-yellow">8625830898</a>
            </p>
        </div>
    </footer>

    <!-- JavaScript for Form Submission and Gemini API -->
    <script>
        // --- Constants for Gemini API ---
        const apiKey = ""; // API key is provided by the environment
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        const MAX_RETRIES = 5;

        // Utility function for exponential backoff
        async function exponentialBackoff(func, retries = 0) {
            try {
                return await func();
            } catch (error) {
                if (retries < MAX_RETRIES) {
                    const delay = Math.pow(2, retries) * 1000 + Math.random() * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    return exponentialBackoff(func, retries + 1);
                } else {
                    console.error("Max retries reached. Failed to fetch from API.", error);
                    throw new Error("API request failed after multiple retries.");
                }
            }
        }

        /**
         * Handles the click event to generate crop advice using the Gemini API.
         */
        async function generateAdvice() {
            const queryTextarea = document.getElementById('crop_query');
            const adviceButton = document.getElementById('adviceButton');
            const loadingIcon = document.getElementById('loadingIcon');
            const aiResultContainer = document.getElementById('aiResultContainer');
            const aiResponseDiv = document.getElementById('aiResponse');
            const aiSourcesDiv = document.getElementById('aiSources');

            const userQuery = queryTextarea.value.trim();

            if (!userQuery) {
                aiResponseDiv.innerHTML = 'рдХреГрдкрдпрд╛ рдЕрдкрдиреА рдлрд╕рд▓ рдФрд░ рд╕рдорд╕реНрдпрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд▓рд┐рдЦреЗрдВред';
                aiResultContainer.classList.remove('hidden');
                return;
            }

            // UI State: Loading
            adviceButton.disabled = true;
            loadingIcon.classList.remove('hidden');
            aiResultContainer.classList.add('hidden');
            aiResponseDiv.textContent = '';
            aiSourcesDiv.textContent = '';

            const systemPrompt = "рдЖрдк рдПрдХ рдЕрдиреБрднрд╡реА рднрд╛рд░рддреАрдп рдХреГрд╖рд┐ рд╕рд▓рд╛рд╣рдХрд╛рд░ рд╣реИрдВ рдЬреЛ рдХрд┐рд╕рд╛рдиреЛрдВ рдХреЛ рд╣рд┐рдВрджреА рдореЗрдВ рд╕рд░рд▓ рдФрд░ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╕рд▓рд╛рд╣ рджреЗрддреЗ рд╣реИрдВред рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдПрдХ рдлрд╕рд▓ рдФрд░ рдЙрд╕рдореЗрдВ рдЖ рд░рд╣реА рд╕рдорд╕реНрдпрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреВрдЫ рд░рд╣рд╛ рд╣реИред рдЙрдиреНрд╣реЗрдВ рддреБрд░рдВрдд, рдкреНрд░рд╛рдердорд┐рдХ, рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рдирд┐рджрд╛рди рдФрд░ рдЙрдкрдЪрд╛рд░ (quick remedies) рдкреНрд░рджрд╛рди рдХрд░реЗрдВред рдЕрдкрдиреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рддреАрди рд╕реНрдкрд╖реНрдЯ рднрд╛рдЧреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░реЗрдВ: 1. рд╕рдВрднрд╛рд╡рд┐рдд рдирд┐рджрд╛рди (Probable Diagnosis), 2. рддреНрд╡рд░рд┐рдд рдЙрдкрд╛рдп (Immediate Remedy) - рдЬреЛ рдХрд┐рд╕рд╛рди рддреБрд░рдВрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ 3. рдЖрдЧреЗ рдХреА рд╕рд▓рд╛рд╣ (Next Steps) - рдЬрд┐рд╕рдореЗрдВ рд╢рд┐рд╡рдЧреМрд░реА рдПрдЧреНрд░реЛ рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░рдиреЗ рдХрд╛ рд╕реБрдЭрд╛рд╡ рд╣реЛред рдЬрд╡рд╛рдм рдореЗрдВ рд╕рд┐рд░реНрдлрд╝ рд╕рд▓рд╛рд╣ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВ, рдХреЛрдИ рдЕрдирд╛рд╡рд╢реНрдпрдХ рдкрд░рд┐рдЪрдп рдпрд╛ рдЙрдкрд╕рдВрд╣рд╛рд░ рдирд╣реАрдВред";
            
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: [{ "google_search": {} }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            const fetchFunc = async () => {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            };

            try {
                const result = await exponentialBackoff(fetchFunc);
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    aiResponseDiv.textContent = text;
                    
                    // Extract and display grounding sources
                    let sourcesHtml = 'рд╕реНрд░реЛрдд: ';
                    let sources = [];
                    const groundingMetadata = candidate.groundingMetadata;

                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);
                    }

                    if (sources.length > 0) {
                        sourcesHtml += sources.map(s => 
                            `<a href="${s.uri}" target="_blank" class="text-agro-green hover:underline">${s.title.substring(0, 50)}...</a>`
                        ).join(', ');
                        aiSourcesDiv.innerHTML = sourcesHtml;
                    } else {
                        aiSourcesDiv.textContent = 'рдХреЛрдИ рдмрд╛рд╣рд░реА рд╕реНрд░реЛрдд рдирд╣реАрдВ рдорд┐рд▓рд╛ред';
                    }

                } else {
                    aiResponseDiv.textContent = 'рдХреНрд╖рдорд╛ рдХрд░реЗрдВ, AI рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рдирд┐рджрд╛рди рдирд╣реАрдВ рдХрд░ рдкрд╛рдпрд╛ред рдХреГрдкрдпрд╛ рд╣рдореЗрдВ рд╕реАрдзреЗ рдХреЙрд▓ рдХрд░реЗрдВред';
                    aiSourcesDiv.textContent = '';
                }

                aiResultContainer.classList.remove('hidden');

            } catch (error) {
                aiResponseDiv.textContent = 'рд╕рд▓рд╛рд╣ рдЬрдирд░реЗрдЯ рдХрд░рддреЗ рд╕рдордп рдПрдХ рддреНрд░реБрдЯрд┐ рд╣реБрдИред рдХреГрдкрдпрд╛ рдереЛрдбрд╝реА рджреЗрд░ рдмрд╛рдж рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ рдпрд╛ рд╣рдореЗрдВ рд╕реАрдзреЗ рдХреЙрд▓ рдХрд░реЗрдВред';
                aiSourcesDiv.textContent = '';
                aiResultContainer.classList.remove('hidden');
            } finally {
                // UI State: Complete
                adviceButton.disabled = false;
                loadingIcon.classList.add('hidden');
            }
        }


        // Simple JavaScript for On-Site Form Submission Message
        function handleSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const name = document.getElementById('name').value;
            const statusMessage = document.getElementById('statusMessage');

            // Simulate form submission success
            statusMessage.textContent = `рдзрдиреНрдпрд╡рд╛рдж, ${name} рдЬреА! рдЖрдкрдХреА рдкреВрдЫрддрд╛рдЫ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдкреНрд░рд╛рдкреНрдд рд╣реЛ рдЧрдИ рд╣реИред рд╣рдо 24 рдШрдВрдЯреЗ рдХреЗ рднреАрддрд░ рдЖрдкрд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВрдЧреЗред`;
            statusMessage.classList.remove('hidden');
            statusMessage.classList.remove('bg-red-100', 'text-red-700');
            statusMessage.classList.add('bg-blue-100', 'text-blue-700');
            form.reset();
        }
    </script>
</body>
</html>
